<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>telegramg login</title>
</head>
<body>
 
    <button id="btn">login</button>
    <button id="logout">logout</button>
    <script async src="https://telegram.org/js/telegram-widget.js?22" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
   
   <script type="text/javascript"> 

        window.onload = function() { 
        
            Telegram.Login.init({bot_id: 8126791498, "request-access": "write"}, function(user) {
                console.log('init', user)
                if (user) {
                    onTelegramAuth(user)
                }
            }); 

            document.getElementById('btn').onclick = function() {
                openLogin()
            }   
            document.getElementById('logout').onclick = function() {
                logout()
            }   
            console.log(Telegram)         

            // 打开弹窗
            function openLogin()  {     
                console.log("openLogin")            
                Telegram.Login.open();
            } 
            // 退出登录
            // ... existing code ...
            function logout() {
                console.log("logout")
                Telegram.Auth.logout();
            }
            // ... existing code ...
            
            function onTelegramAuth(user) { 
                // 向app传参
                if(window.flutter_inappwebview){
                    window.flutter_inappwebview.callHandler('NativeBridge', user);
                }
            }

            // 接受 user信息
            window.addEventListener('message', (event) => {
            // 验证来源
                if (event.origin === 'http://your-parent-page.com') { // 替换为父页面的真实 origin
                    console.log('Message from parent:', event.data);
                    // 可以选择响应父页面
                    event.source.postMessage('Hello from child!', event.origin);
                }
            });
        };  
        
    </script>
</body>
</html>
