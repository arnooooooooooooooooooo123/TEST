<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>telegramg login</title>
</head>
<body>
 
    <button id="btn">login</button>
    <button id="logout">logout</button>
    <script async src="https://telegram.org/js/telegram-widget.js?22" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
    <!-- <script async src="https://telegram.org/js/widget-frame.js?63"></script> -->
   <script type="text/javascript"> 

        window.onload = function() { 
            var user;
             // 删除 cookie
            function deleteCookie(name, path, domain) {
                // 设置 Cookie 的过期时间为过去的时间
                let expires = '; expires=Thu, 01 Jan 1970 00:00:00 UTC;'
                if (path) {
                    expires += ` path=${path};`
                }
                if (domain) {
                    expires += ` domain=${domain};`
                }
                // 删除 Cookie
                document.cookie = `${name}=${expires}`
            }

        
            Telegram.Login.init({bot_id: 8126791498, "request-access": "write"}, function(user) {
                console.log('init', user)
                if (user) {
                    user = user;
                    onTelegramAuth(user)
                }
            }); 


            document.getElementById('btn').onclick = function() {
                openLogin()
            }   
            document.getElementById('logout').onclick = function() {
                logout()
            }   
            console.log(Telegram.Login.logout)         

            // 打开弹窗
            function openLogin()  {     
                console.log("openLogin")            
                Telegram.Login.open();
            } 
            
            // 退出登录
            // ... existing code ...
            function logout() {
                console.log(Telegram.Login.auth.checkClose)
                console.log(user)
                // '/auth/logout?bot_id=547043436&origin=https%3A%2F%2Fcore.telegram.org&embed=1&request_access=write&return_to=https%3A%2F%2Fcore.telegram.org%2Fwidgets%2Flogin&hash=ea162c4fc040f291b3'
                // location.href = 'https://oauth.telegram.org/auth/logout?bot_id=8126791498&origin=https://arnooooooooooooooooooo123.github.io&return_to=https://arnooooooooooooooooooo123.github.io/TEST/telegram-login.html&embed=1&request_access=write&hash="1612de073c08cbe1d98012f023a3535e9e7161d172cdd60c1cb85a5f4ab029ab"'
            // console.log("Starting logout...");
                // console.log("Clearing localStorage...");
                // localStorage.clear();
                // console.log("Clearing sessionStorage...");
                // sessionStorage.clear();
                // console.log("Deleting telegram cookies...");
                // deleteCookie('stel_ssid', '/', '.telegram.org');
                // deleteCookie('stel_token', '/', '.telegram.org');
                // console.log("Logout complete");
                
                // deleteCookie('stel_ssid', '/', '.github.io');
                // deleteCookie('stel_token', '/', '.github.io');
            }
            // ... existing code ...
            
            function onTelegramAuth(user) { 
                // 向app传参
                if(window.flutter_inappwebview){
                    window.flutter_inappwebview.callHandler('NativeBridge', user);
                }
            }

            // 接受 user信息
            window.addEventListener('message', (event) => {
            // 验证来源
                if (event.origin === 'http://your-parent-page.com') { // 替换为父页面的真实 origin
                    console.log('Message from parent:', event.data);
                    // 可以选择响应父页面
                    event.source.postMessage('Hello from child!', event.origin);
                }
            });
        };  
        
    </script>

    <!-- <script>
        window.onload = function() {
            console.log(TWidgetLogin)


            TWidgetLogin.init('widget_login', 8126791498, {"request_access":"write"}, false);

            document.getElementById('btn').onclick = function() {
                TWidgetLogin.auth()
            }
        }
    </script> -->
</body>
</html>
